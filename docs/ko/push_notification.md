# ğŸ”” í‘¸ì‹œ ì•Œë¦¼

DfineryëŠ” Firebase Cloud Messagingì„ ì‚¬ìš©í•˜ì—¬ í‘¸ì‹œë¥¼ ìˆ˜ì‹ ë°›ìœ¼ë¯€ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Firebase ì—°ë™ì´ í•„ìš”í•©ë‹ˆë‹¤.

## Android í”„ë¡œì íŠ¸ì— Firebase ì¶”ê°€í•˜ê¸°
Firebaseì—ì„œ ì œê³µë˜ëŠ” [Android í”„ë¡œì íŠ¸ì— Firebase ì¶”ê°€](https://firebase.google.com/docs/android/setup?hl=ko#next_steps) ì˜ ì§€ì‹œì‚¬í•­ì— ë”°ë¼ Android í”„ë¡œì íŠ¸ì— Firebaseë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

## Dfinery Consoleì—ì„œ Firebase ì •ë³´ ë“±ë¡í•˜ê¸°
Consoleì—ì„œ [ë¶€ê°€ì„¤ì •/ì±„ë„ ë¶€ê°€ ì„¤ì •/í‘¸ì‹œ/Android ì„¤ì •ê´€ë¦¬](https://console.dfinery.ai)ì— ë“¤ì–´ê°€ ë°œì‹ ì IDë¥¼ ì…ë ¥í•˜ê³  JSON í˜•ì‹ì˜ Firebase ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë¹„ê³µê°œ í‚¤ íŒŒì¼ì„ ì—…ë¡œë“œí•©ë‹ˆë‹¤.

### ë°œì‹ ì ID í™•ì¸ ë°©ë²•

#### 1. [Firebase Console](https://console.firebase.google.com/)ë¡œ ì´ë™í•©ë‹ˆë‹¤.
#### 2. í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
#### 3. ì¢Œì¸¡ íŒ¨ë„ì—ì„œ í”„ë¡œì íŠ¸ ê°œìš” ì˜¤ë¥¸ìª½ì— âš™ï¸ ì•„ì´ì½˜ì„ í´ë¦­í•©ë‹ˆë‹¤.
#### 4. í”„ë¡œì íŠ¸ ì„¤ì •ì„ í´ë¦­í•©ë‹ˆë‹¤.
#### 5. í”„ë¡œì íŠ¸ ì„¤ì • ìƒë‹¨ íƒ­ì—ì„œ í´ë¼ìš°ë“œ ë©”ì‹œì§•ì„ í´ë¦­í•©ë‹ˆë‹¤.
#### 6. [ë°œì‹ ì ID](https://firebase.google.com/docs/cloud-messaging/concept-options?hl=ko#senderid)ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

### Firebase ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë¹„ê³µê°œ í‚¤ íŒŒì¼ ë°œê¸‰ ë°©ë²•

Firebaseì—ì„œ ì œê³µí•˜ëŠ” [ìˆ˜ë™ìœ¼ë¡œ ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ì œê³µ](https://firebase.google.com/docs/cloud-messaging/auth-server?hl=ko#provide-credentials-manually)ì„ ì°¸ê³ í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ í‚¤ë¥¼ ì €ì¥í•œë‹¤ìŒ Consoleì— íŒŒì¼ì„ ì—…ë¡œë“œ í•´ì£¼ì„¸ìš”.

í•´ë‹¹ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì£¼ìš” ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
> 1. [Firebase Console](https://console.firebase.google.com/)ì—ì„œ ì„¤ì • > [ì„œë¹„ìŠ¤ ê³„ì •](https://console.cloud.google.com/iam-admin/)ì„ ì—½ë‹ˆë‹¤.
> 2. ìƒˆ ë¹„ê³µê°œ í‚¤ ìƒì„±ì„ í´ë¦­í•œ ë‹¤ìŒ í‚¤ ìƒì„±ì„ í´ë¦­í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.
> 3. í‚¤ê°€ ë“¤ì–´ ìˆëŠ” JSON íŒŒì¼ì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•©ë‹ˆë‹¤.

ë§Œì•½ ë¹„ê³µê°œ í‚¤ íŒŒì¼ ë°œê¸‰ì— ì–´ë ¤ì›€ì„ ê²ªìœ¼ì‹¤ ê²½ìš° [Firebase ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë¹„ê³µê°œ í‚¤ íŒŒì¼ ë°œê¸‰ ë”°ë¼í•´ë³´ê¸°](#firebase-ì‚¬ìš©ì-ì¸ì¦-ì •ë³´-ë¹„ê³µê°œ-í‚¤-íŒŒì¼-ë°œê¸‰-ë”°ë¼í•´ë³´ê¸°)ë¥¼ ì°¸ê³ í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

## Firebase Cloud Messaging ì„¤ì •í•˜ê¸°
Firebaseì—ì„œ ì œê³µë˜ëŠ” [Androidì—ì„œ Firebase í´ë¼ìš°ë“œ ë©”ì‹œì§• í´ë¼ì´ì–¸íŠ¸ ì•± ì„¤ì •](https://firebase.google.com/docs/cloud-messaging/android/client?hl=ko) ì˜ ì§€ì‹œì‚¬í•­ì— ë”°ë¼ ë‹¤ìŒì˜ í•­ëª©ì„ ì ìš©í•©ë‹ˆë‹¤.
- [ì•± ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— FirebaseMessagingServiceë¥¼ ìƒì†ë°›ëŠ” ì„œë¹„ìŠ¤ ì¶”ê°€](https://firebase.google.com/docs/cloud-messaging/android/client?hl=ko#manifest)
- [Android 13 ì´ìƒì—ì„œ ì ìš©ë˜ëŠ” ëŸ°íƒ€ì„ ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ ì‘ì„±](https://firebase.google.com/docs/cloud-messaging/android/client?hl=ko#request-permission13)
- [ê¸°ê¸° ë“±ë¡ í† í° ì•¡ì„¸ìŠ¤ ì—°ë™](https://firebase.google.com/docs/cloud-messaging/android/client?hl=ko#sample-register)

## Support Library ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸°
DfineryëŠ” í‘¸ì‹œ ì•Œë¦¼ì„ ì‘ì„±í•˜ëŠ”ë° [Support Library](https://developer.android.com/jetpack/androidx/releases/core?hl=ko)ë¥¼ í•„ìš”ë¡œ í•˜ë¯€ë¡œ ë‹¤ìŒì˜ ì¼ë ¨ì˜ ë‹¨ê³„ë¥¼ ì™„ë£Œí•˜ì„¸ìš”.
### 1. ì•±ì˜ ëª¨ë“ˆ ë””ë ‰í„°ë¦¬ ë‚´ì— ìˆëŠ” `build.gradle` íŒŒì¼ì„ ì—½ë‹ˆë‹¤.
### 2. dependenciesì— Support Library ì˜ì¡´ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```
 dependencies {
    implementation 'androidx.core:core:1.9.0'
}
```

## í† í°ì„ Dfineryì— ì—°ë™í•˜ê¸°
Firebaseì—ì„œ ë°œê¸‰ëœ í† í°ì„ Dfineryì— ì—°ë™í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
### í˜„ì¬ ë“±ë¡ í† í° ê°€ì ¸ì˜¤ê¸° ì‹œ ì—°ë™

> [!TIP]
> í† í°ì€ ìì£¼ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì½”ë“œê°€ ìì£¼ ë¶ˆë¦¬ì§€ ì•Šë„ë¡ Applicationì„ ìƒì†ë°›ì€ ê°ì²´ì˜ [onCreate()](https://developer.android.com/reference/android/app/Application#onCreate()) ë©”ì†Œë“œì— ì‘ì„±í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤. 

<details open>
  <summary>Java</summary>

```java
FirebaseMessaging.getInstance().getToken().addOnCompleteListener(new OnCompleteListener<String>() {
    @Override
    public void onComplete(@NonNull Task<String> task) {
        if (!task.isSuccessful()) {
            Log.w(TAG, "Fetching FCM registration token failed", task.getException());
            return;
        }

        // Get new FCM registration token
        String token = task.getResult();
        DfineryProperties.setPushToken(token);
    }
});
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
FirebaseMessaging.getInstance().token.addOnCompleteListener(OnCompleteListener { task ->
    if (!task.isSuccessful) {
        Log.w(TAG, "Fetching FCM registration token failed", task.exception)
        return@OnCompleteListener
    }

    // Get new FCM registration token
    val token = task.result
    DfineryProperties.setPushToken(token)
})
```

</details>

### í† í° ìƒì„± ëª¨ë‹ˆí„°ë§ ì‹œ ì—°ë™
FirebaseMessagingServiceë¥¼ ìƒì†ë°›ì€ í´ë˜ìŠ¤ì—ì„œ [onNewToken(String)](https://firebase.google.com/docs/reference/android/com/google/firebase/messaging/FirebaseMessagingService#onNewToken(java.lang.String)) ë©”ì†Œë“œë¥¼ Override í•˜ì—¬ í† í°ì„ Dfineryì— ë“±ë¡í•©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
@Override
public void onNewToken(@NonNull String token) {
    Log.d(TAG, "Refreshed token: " + token);
    DfineryProperties.setPushToken(token);
}
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
override fun onNewToken(token: String) {
    Log.d(TAG, "Refreshed token: $token")
    DfineryProperties.setPushToken(token)
}
```

</details>

## í‘¸ì‹œ ì•Œë¦¼ ì±„ë„ì„ Dfineryì— ì—°ë™í•˜ê¸°
### í‘¸ì‹œ ì•Œë¦¼ ì±„ë„ ìƒì„±
Android 8.0ë¶€í„°ëŠ” ì•Œë¦¼ì„ ìˆ˜ì‹ ë°›ê¸° ìœ„í•´ ì•Œë¦¼ ì±„ë„ ìƒì„±ì´ í•„ìš”í•©ë‹ˆë‹¤. Androidì—ì„œ ì œê³µí•˜ëŠ” [ì•Œë¦¼ ì±„ë„ ë§Œë“¤ê¸° ë° ê´€ë¦¬](https://developer.android.com/training/notify-user/channels?hl=ko)ì˜ ì§€ì‹œì‚¬í•­ê³¼ [ì•Œë¦¼ ì±„ë„ ìƒì„± ë”°ë¼í•´ë³´ê¸°](#ì•Œë¦¼-ì±„ë„-ìƒì„±-ë”°ë¼í•´ë³´ê¸°)ë¥¼ ì°¸ê³ í•˜ì—¬ ì•Œë¦¼ ì±„ë„ì„ ìƒì„±í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

> [!WARNING]
> í•œë²ˆ ìƒì„±ëœ ì•Œë¦¼ ì±„ë„ì— ëŒ€í•œ ì„¤ì • ì •ë³´ëŠ” ì´ë¦„ê³¼ ì„¤ëª…ë“±ì˜ ì •ë³´ë¥¼ ì œì™¸í•˜ê³ ëŠ” ì½”ë“œë¥¼ í†µí•´ ì„¤ì • ê°’ì´ ë³€ê²½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ ì•Œë¦¼ ì±„ë„ì— ëŒ€í•œ ì„¤ì • ì •ë³´ëŠ” ì‚¬ìš©ìì— ì˜í•´ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ ì˜ ë°”ëë‹ˆë‹¤. 

### ìƒì„±í•œ í‘¸ì‹œ ì•Œë¦¼ ì±„ë„ ID ë“±ë¡
DfineryConfigì˜ `setDefaultNotificationChannelId()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•œ ì•Œë¦¼ ì±„ë„ì˜ IDë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
DfineryConfig config = new DfineryConfig.Builder()
    .setDefaultNotificationChannelId("{your_notification_channel_id}")
    .build();
Dfinery.getInstance().init(this, "{your_application_key}", config);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
val config = DfineryConfig.Builder()
    .setDefaultNotificationChannelId("{your_notification_channel_id}")
    .build()
Dfinery.getInstance().init(this, "{your_application_key}", config)
```

</details>

## í‘¸ì‹œ ì•Œë¦¼ ì•„ì´ì½˜ ì„¤ì •í•˜ê¸°
í‘¸ì‹œ ì•Œë¦¼ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ì´ì½˜ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. DfineryConfigì˜ `setNotificationIconResourceId()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ì´ì½˜ì„ ì„¤ì •í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

> [!TIP]
> ì•Œë¦¼ ìì²´ëŠ” ë¬¼ë¡  ìƒë‹¨ ìƒíƒœ í‘œì‹œì¤„ì—ë„ í‘œì‹œë˜ëŠ” ì•„ì´ì½˜ì´ê¸° ë•Œë¬¸ì— ì´ë¯¸ì§€ì˜ ìƒ‰ìƒì´ ë¬´ì‹œë˜ë‹ˆ 72x72pxì˜ íˆ¬ëª…ìƒ‰(ì•ŒíŒŒì±„ë„)ì„ ê°€ì§„ ì´ë¯¸ì§€ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
DfineryConfig config = new DfineryConfig.Builder()
    .setNotificationIconResourceId(R.drawable.icon)
    .build();
Dfinery.getInstance().init(this, "{your_application_key}", config);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
val config = DfineryConfig.Builder()
    .setNotificationIconResourceId(R.drawable.icon)
    .build()
Dfinery.getInstance().init(this, "{your_application_key}", config)
```

</details>

## í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  ì²˜ë¦¬í•˜ê¸°
í‘¸ì‹œê°€ ìˆ˜ì‹ ë˜ë©´ FirebaseMessagingServiceë¥¼ ìƒì†ë°›ì€ ê°ì²´ì— í‘¸ì‹œ ìˆ˜ì‹  ì´ë²¤íŠ¸ê°€ ë°œìƒí•©ë‹ˆë‹¤. DfineryëŠ” ìˆ˜ì‹ ëœ í‘¸ì‹œ í˜ì´ë¡œë“œë¥¼ í† ëŒ€ë¡œ ì•Œë¦¼ì„ ìƒì„±í•˜ë¯€ë¡œ í•´ë‹¹ ê°ì²´ì˜ [onMessageReceived(RemoteMessage)](https://firebase.google.com/docs/reference/android/com/google/firebase/messaging/FirebaseMessagingService#onMessageReceived(com.google.firebase.messaging.RemoteMessage)) ì†Œë“œ ë‚´ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
@Override
public void onMessageReceived(@NonNull RemoteMessage remoteMessage) {
    super.onMessageReceived(remoteMessage);
    if(Dfinery.getInstance().handleRemoteMessage(getApplicationContext(), remoteMessage)){
        //dfinery push
    }else{
        //This is not a push notification sent from Dfinery.
    }
}
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
override fun onMessageReceived(remoteMessage: RemoteMessage) {
  if(Dfinery.getInstance().handleRemoteMessage(applicationContext, remoteMessage)){
        //dfinery push
    }else{
        //This is not a push notification sent from Dfinery.
    }
}
```

</details>

## í‘¸ì‹œ ì•Œë¦¼ í´ë¦­ ì²˜ë¦¬í•˜ê¸°
í‘¸ì‹œë¥¼ í´ë¦­í•  ê²½ìš° ë”¥ë§í¬ì— ì„¤ì •ëœ Activityê°€ ì‹¤í–‰ë˜ê±°ë‚˜ ë”¥ë§í¬ê°€ ì—†ì„ ê²½ìš° `android.intent.action.MAIN` ì•¡ì…˜ì„ ê°€ì§€ê³  ìˆëŠ” Activityê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. 

í´ë¦­í•œ í‘¸ì‹œ ë°ì´í„°ëŠ” í•´ë‹¹í•˜ëŠ” Activityì˜ `onCreate(Bundle)` ë©”ì†Œë“œë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
í´ë¦­í•œ ë°ì´í„°ë¥¼ í™œìš©í•˜ê³  ì‹¶ìœ¼ì‹¤ ê²½ìš° ì´ê³³ì—ì„œ `getDfineryPushNotification()`ë¥¼ ì‚¬ìš©í•˜ì—¬ í‘¸ì‹œ ë°ì´í„°ê°€ ë‹´ê²¨ìˆëŠ” [PushNotification](#pushpayload-ì•Œì•„ë³´ê¸°) ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> [!WARNING]
> ë°ì´í„° íŒŒì‹±ì— ì‹¤íŒ¨í•˜ê±°ë‚˜ Intentì— í‘¸ì‹œ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° nullì´ ë°˜í™˜ë˜ë¯€ë¡œ ë°˜ë“œì‹œ null ì²´í¬ë¥¼ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    PushNotification pushNotification = Dfinery.getInstance().getDfineryPushNotification(getIntent());
    if(pushNotification != null){
        String title = pushNotification.getTitle();
    }
}
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    val pushNotification = Dfinery.getInstance().getDfineryPushNotification(intent)
    pushNotification?.let { 
        it.title
    }
}
```
</details>

## í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹  í—ˆìš© ìœ ë¬´ ë°˜ì˜í•˜ê¸°
ê´‘ê³ ì„± ëª©ì ì´ ìˆëŠ” í‘¸ì‹œì˜ ê²½ìš° [ì •ë³´í†µì‹ ë§ë²•](https://www.law.go.kr/ë²•ë ¹/ì •ë³´í†µì‹ ë§%20ì´ìš©ì´‰ì§„%20ë°%20ì •ë³´ë³´í˜¸%20ë“±ì—%20ê´€í•œ%20ë²•ë¥ /ì œ50ì¡°#:~:text=ì œ50ì¡°) ì— ë”°ë¼ ì‚¬ìš©ìì—ê²Œ ì‚¬ì „ ìˆ˜ì‹ ë™ì˜ë¥¼ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. ì‚¬ìš©ìì—ê²Œ í‘¸ì‹œ ì•Œë¦¼ì´ í—ˆìš©ë˜ì—ˆë‹¤ëŠ” ì •ë³´ë¥¼ Dfineryì— ë°˜ì˜í•˜ê¸° ìœ„í•´ì„œ ë‹¤ìŒì˜ ì¼ë ¨ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

### 1. ì‚¬ìš©ìì—ê²Œ í‘¸ì‹œ ì•Œë¦¼ í—ˆìš©ì— ëŒ€í•œ ê³ ì§€í•˜ê¸°
### 2. ì‚¬ìš©ìì˜ í—ˆìš©/ê±°ë¶€ ì˜ì‚¬ì— ëŒ€í•œ ê°’ì„ ë°˜ì˜í•˜ê¸° ìœ„í•´ ë‹¤ìŒì˜ ì½”ë“œë¥¼ ì‘ì„±

[ì•Œë¦¼ ìˆ˜ì‹  ë™ì˜ ì„¤ì •í•˜ê¸°](./user_profile.md#ì•Œë¦¼-ìˆ˜ì‹ -ë™ì˜-ì •ë³´-ì„¤ì •í•˜ê¸°)ë¥¼ ì°¸ê³ í•˜ì—¬ ì‚¬ìš©ìê°€ ë™ì˜í•œ í•­ëª©ì— ëŒ€í•´ ê°’ì„ ì…ë ¥í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤. ì•„ë˜ ì½”ë“œëŠ” í‘¸ì‹œ ì±„ë„ì— ê´€í•´ ì •ë³´ì„±, ê´‘ê³ ì„± ìˆ˜ì‹  ë™ì˜ë¥¼ í—ˆìš©í•œ ì˜ˆì‹œì…ë‹ˆë‹¤.

<details open>
<summary>Java</summary>

```java
Map<String, Object> consents = new HashMap<>();
consents.put(DF.UserProfile.INFORMATIONAL_NOTIFICATION_FOR_PUSH_CHANNEL, true);
consents.put(DF.UserProfile.ADVERTISING_NOTIFICATION_FOR_PUSH_CHANNEL, true);
DfineryProperties.setUserProfiles(consents);
```

</details>
<details open>
<summary open >Kotlin</summary>

```kotlin
val consents = mapOf<String, Any>(
    DF.UserProfile.INFORMATIONAL_NOTIFICATION_FOR_PUSH_CHANNEL to true, 
    DF.UserProfile.ADVERTISING_NOTIFICATION_FOR_PUSH_CHANNEL to true
)
DfineryProperties.setUserProfiles(consents)
```


## ì™„ë£Œ
ì´ì œ Dfineryì—ì„œ ì•Œë¦¼ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ëª¨ë“  ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

## ë” ì•Œì•„ë³´ê¸°
### ì•Œë¦¼ ì±„ë„ ìƒì„± ë”°ë¼í•´ë³´ê¸°
ì•Œë¦¼ ì±„ë„ì„ ìƒì„±í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤. [Androidì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì œ](https://developer.android.com/develop/ui/views/notifications/channels?hl=ko#CreateChannel)ë„ ìˆìœ¼ë¯€ë¡œ ì°¸ê³  ë°”ëë‹ˆë‹¤.

#### 1. ì•Œë¦¼ ì±„ë„ì„ ìƒì„±í•©ë‹ˆë‹¤.

> ì•Œë¦¼ ì±„ë„ APIëŠ” [Android 8.0](https://developer.android.com/about/versions/oreo?hl=ko)ì´ìƒì—ì„œ ì§€ì›í•©ë‹ˆë‹¤.

- ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„° idëŠ” ì•Œë¦¼ ì±„ë„ì˜ IDë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
- ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„° nameì€ ì•Œë¦¼ ì±„ë„ì˜ ì´ë¦„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í•´ë‹¹ ê°’ì€ `ì„¤ì •/ì•Œë¦¼`ì—ì„œ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë©ë‹ˆë‹¤.
- ì„¸ë²ˆì§¸ íŒŒë¼ë¯¸í„° importanceëŠ” ì´ ì•Œë¦¼ ì±„ë„ë¡œ ìˆ˜ì‹ ë  í‘¸ì‹œ ì•Œë¦¼ì˜ [ì¤‘ìš”ë„](https://developer.android.com/develop/ui/views/notifications/channels?hl=ko#importance)ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
NotificationChannel notificationChannel = new NotificationChannel("{id}", "{name}", NotificationManager.IMPORTANCE_HIGH);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
val notificationChannel = NotificationChannel("{id}", "{name}", NotificationManager.IMPORTANCE_HIGH)
```

</details>

#### 2. ì•Œë¦¼ ì±„ë„ì˜ ì„¤ëª…ì„ ì„¤ì •í•©ë‹ˆë‹¤. (Optional)
í•´ë‹¹ ê°’ì€ `ì„¤ì •/ì•Œë¦¼`ì—ì„œ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
notificationChannel.setDescription("{description}");
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
notificationChannel.description = "{description}"
```

</details>

#### 3. ì•Œë¦¼ ì±„ë„ì˜ ì§„ë™ ìœ ë¬´ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. (Optional)

> ì•Œë¦¼ ì±„ë„ì˜ ê°’ì€ Dfinery Consoleì—ì„œ ì„¤ì • í•œ ê°’ ì¤‘ 'ì•± ì‹¤í–‰ ì¤‘ í‘¸ì‹œ ë©”ì‹œì§€ ë…¸ì¶œ'ì„ ì œì™¸í•œ ëª¨ë“  ì„¤ì •ë³´ë‹¤ í•­ìƒ ìš°ì„ ì‹œë©ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
notificationChannel.enableVibration(true);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
notificationChannel.enableVibration(true)
```

</details>

#### 4. ì•Œë¦¼ ì±„ë„ì˜ ì•Œë¦¼ìŒì„ ì„¤ì •í•©ë‹ˆë‹¤. (Optional)
ì‹œìŠ¤í…œ ê¸°ë³¸ ì•Œë¦¼ìŒì„ ì¬ìƒí•˜ë„ë¡ ì„¤ì •í•œ ì˜ˆì œì…ë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
Uri soundUri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);
AudioAttributes audioAttributes = new AudioAttributes.Builder()
        .setUsage(AudioAttributes.USAGE_NOTIFICATION)
        .build();
notificationChannel.setSound(soundUri, audioAttributes);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
val soundUri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION)
val audioAttributes = AudioAttributes.Builder()
    .setUsage(AudioAttributes.USAGE_NOTIFICATION)
    .build()
notificationChannel.setSound(soundUri, audioAttributes)
```

</details>

#### 5. NotificationManagerì— ìƒì„±í•œ ì•Œë¦¼ ì±„ë„ì„ ë“±ë¡í•©ë‹ˆë‹¤.
<details open>
  <summary>Java</summary>

```java
NotificationManager notificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);
notificationManager.createNotificationChannel(notificationChannel);
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
val notificationManager = getSystemService(NOTIFICATION_SERVICE) as NotificationManager
notificationManager.createNotificationChannel(notificationChannel)
```

</details>

#### 6. ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

### PushPayload ì•Œì•„ë³´ê¸°
PushPayloadëŠ” í‘¸ì‹œ ë°ì´í„°ë¥¼ ë‹´ê³ ìˆëŠ” ê°ì²´ì…ë‹ˆë‹¤. Dfineryë¥¼ í†µí•´ ìˆ˜ì‹ ëœ í˜ì´ë¡œë“œì˜ í‚¤ ê°’ ìƒìˆ˜ì™€ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ë©”ì†Œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
#### getNotificationId()
- ë°˜í™˜ ìœ í˜• : Integer
- ë‚´ìš© : ì•Œë¦¼ ID ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### getTitle()
- ë°˜í™˜ ìœ í˜• : String
- ë‚´ìš© : ì•Œë¦¼ ì œëª© ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### getBody()
- ë°˜í™˜ ìœ í˜• : String
- ë‚´ìš© : ì•Œë¦¼ ë‚´ìš© ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### getImageUrl()
- ë°˜í™˜ ìœ í˜• : String
- ë‚´ìš© : ì•Œë¦¼ ì´ë¯¸ì§€ URL ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### getCampaignId()
- ë°˜í™˜ ìœ í˜• : String
- ë‚´ìš© : ì•Œë¦¼ì— í•´ë‹¹í•˜ëŠ” ìº í˜ì¸ ID ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

#### getDeeplink()
- ë°˜í™˜ ìœ í˜• : String
- ë‚´ìš© : ì•Œë¦¼ í´ë¦­ ì‹œì˜ ë”¥ë§í¬ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

#### getPushClickAction()
- ë°˜í™˜ ìœ í˜• : `com.igaworks.dfinery.models.PushClickAction`
- ë‚´ìš© : ì•Œë¦¼ í´ë¦­ ì‹œì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

#### useRing()
- ë°˜í™˜ ìœ í˜• : Boolean
- ë‚´ìš© : [Dfinery Console](https://console.dfinery.ai/)ì˜ ë©”ì‹œì§€ ë¶€ê°€ ì„¤ì •ì—ì„œ ì„¤ì •í•œ "ì‚¬ìš´ë“œ ì‚¬ìš©"ì˜ ì²´í¬ ìœ ë¬´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì•Œë¦¼ ìƒì„±ì‹œ Android 8.0ì´ìƒì˜ ê¸°ê¸°ì˜ ê²½ìš°, ì´ ê°’ì€ ì•Œë¦¼ ì±„ë„ ì„¤ì •ì— ì˜í•´ ë¬´ì‹œë©ë‹ˆë‹¤.

#### useVibrate()
- ë°˜í™˜ ìœ í˜• : Boolean
- ë‚´ìš© : [Dfinery Console](https://console.dfinery.ai/)ì˜ ë©”ì‹œì§€ ë¶€ê°€ ì„¤ì •ì—ì„œ ì„¤ì •í•œ "ì§„ë™ ì‚¬ìš©"ì˜ ì²´í¬ ìœ ë¬´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ì•Œë¦¼ ìƒì„±ì‹œ Android 8.0ì´ìƒì˜ ê¸°ê¸°ì˜ ê²½ìš°, ì´ ê°’ì€ ì•Œë¦¼ ì±„ë„ ì„¤ì •ì— ì˜í•´ ë¬´ì‹œë©ë‹ˆë‹¤.

#### isNotifyWhenApplicationIsForeground()
- ë°˜í™˜ ìœ í˜• : Boolean
- ë‚´ìš© : [Dfinery Console](https://console.dfinery.ai/)ì˜ ë©”ì‹œì§€ ë¶€ê°€ ì„¤ì •ì—ì„œ ì„¤ì •í•œ "ì•± ì‹¤í–‰ ì¤‘ í‘¸ì‹œ ë©”ì‹œì§€ ë…¸ì¶œ"ì˜ ì²´í¬ ìœ ë¬´ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

### SDK ë™ì‘ ì—†ì´ PushPayload ê°€ì ¸ì˜¤ê¸°
`getDfineryPushNotification()` APIë¥¼ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ SDK ë™ì‘ ì—†ì´ Intentì— í¬í•¨ë˜ì–´ ìˆëŠ” Extra í˜¹ì€ RemoteMessageë¥¼ íŒŒì‹±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details open>
  <summary>Java</summary>

```java
@Override
public void onMessageReceived(@NonNull RemoteMessage remoteMessage) {
    super.onMessageReceived(remoteMessage);
    PushNotification pushNotification = Dfinery.getInstance().getDfineryPushNotification(remoteMessage);
}
```

</details>

<details open>
  <summary>Kotlin</summary>

```kotlin
override fun onMessageReceived(remoteMessage: RemoteMessage) {
  val pushNotification = Dfinery.getInstance().getDfineryPushNotification(remoteMessage);
}
```
</details>

### Firebase ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë¹„ê³µê°œ í‚¤ íŒŒì¼ ë°œê¸‰ ë”°ë¼í•´ë³´ê¸°
#### 1. [ì„œë¹„ìŠ¤ ê³„ì •](https://console.cloud.google.com/iam-admin/serviceaccounts)ì— ì ‘ì†í•©ë‹ˆë‹¤.
#### 2. ë°œê¸‰ í•˜ê³  ì‹¶ì€ í‚¤ì˜ í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

> í”„ë¡œì íŠ¸ê°€ ì—†ì„ ê²½ìš° Firebase í”„ë¡œì íŠ¸ ìƒì„±ì´ ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»ì´ë¯€ë¡œ [Android í”„ë¡œì íŠ¸ì— Firebase ì¶”ê°€í•˜ê¸°](https://firebase.google.com/docs/android/setup?hl=ko#next_steps)ë¥¼ ì°¸ê³ í•˜ì—¬ Firebase í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

![select a recent project](../../assets/certificate_1.png)
#### 3. ìš°ì¸¡ í•˜ë‹¨ì˜ ì‘ì—…ì—ì„œ â‹®ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![click a action](../../assets/certificate_2.png)
#### 4. ë“œë¡­ë‹¤ìš´ì—ì„œ í‚¤ ê´€ë¦¬ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![click a manage keys](../../assets/certificate_3.png)
#### 5. í‚¤ ì¶”ê°€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

> ì´ë¯¸ ìƒì„±ëœ í‚¤ê°€ ìˆì„ ê²½ìš°, ê¸°ì¡´ì— í‚¤ë¥¼ ìƒì„±í•œ ì´ë ¥ì´ ìˆë‹¤ëŠ” ëœ»ì´ë©° í•´ë‹¹ í‚¤ë¥¼ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤. í•´ë‹¹ í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš° ìƒˆë¡œ í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

![click a add key](../../assets/certificate_4.png)
#### 6. ë“œë¡­ë‹¤ìš´ì—ì„œ ìƒˆ í‚¤ ë§Œë“¤ê¸°ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![click a create new key](../../assets/certificate_5.png)
#### 7. JSONì„ ì„ íƒ í›„ ë§Œë“¤ê¸°ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
![create a key](../../assets/certificate_6.png)
#### 8. í‚¤ ë°œê¸‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.